---
- name: "Bring up docker containers for docker connection inventory iface"
  hosts: localhost
  roles:
    - role: provision_docker
      provision_docker_privileged: true,
      provision_docker_inventory_group: "{{ groups['robots'] }}"
      provision_docker_use_docker_connection: true

- hosts: robots
  roles:
    - role: "{{ lookup('env', 'PWD') }}"
      certificate:
        common_name: "{{ ansible_fqdn }}"

        cert_dir: "/etc/ssl/{{ certificate.common_name }}"
        cert_path: "{{ cert_dir }}/{{ certificate.common_name }}.pem"
        chain_path: "{{ cert_dir }}/{{ certificate.common_name }}.chain.pem"
        privatekey_path: "{{ cert_dir }}/{{ certificate.common_name }}.key"
        csr_path: "{{ cert_dir }}/{{ certificate.common_name }}.csr"

        #Where to execute venafi_certificate module. If set to false certificate will be
        #created on ansible master host and then copied to the remote server
        remote_execution: false
        #  remote location where to place the certificate.
        remote_cert_path: "{{ cert_dir }}/{{ certificate.common_name }}.pem"
        remote_chain_path: "{{ cert_dir }}/{{ certificate.common_name }}.chain.pem"
        remote_private_key_path: "{{ cert_dir }}/{{ certificate.common_name }}.key"
        # Set to false if you don't want to copy private key to remote location
        copy_private_key_to_remote: true
